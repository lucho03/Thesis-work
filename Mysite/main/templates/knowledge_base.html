{% extends "layout.html" %}

{% block title %}
    <title>Tickets</title>
{% endblock %}

{% block content %}
{% load crispy_forms_tags %}
{% for ticket in tickets %}
<div class="container d-flex justify-content-center mt-5">
    <div class="card mt-4 mb-3" style="width:55rem;" id="card-{{ticket.id}}" >
        <div class="card-header">
            <div class="row">
                <div class="col">
                    <p class="lead">{{ticket.author}}</p><br>
                </div>
                <div class="col">
                    <p>{{ticket.author.email}}</p><br>
                </div>
                <div class="col">
                    <p>{{ticket.date}}</p><br>
                </div>
            </div>
        </div>
        <div class="card-body">
            <h5 class="card-title text-center">{{ticket.title}}</h5>
            <div class="border">
                <p class="card-text m-3">{{ticket.text}}</p>
            </div>
            {% if ticket.num_answers == 0 %}
            <button class="btn btn-info mt-2 btn-block" disabled>
            {% else %}
            <button class="btn btn-primary mt-2 btn-block" role="button" value="{{ticket.id}}" name="answers" id="answers-view-{{ticket.id}}">
            {% endif %}
                Answers
                <span class="badge badge-light">
                    {{ticket.num_answers}}
                </span>
            </button>
            
            {% if ticket.ticket_comments == 0 %}
            <button class="btn btn-primary btn-block" disabled>
            {% else %}
            <button class="btn btn-primary btn-block" type="button" data-toggle="collapse" data-target="#collapse-{{ticket.id}}" aria-expanded="false" aria-controls="collapse-{{ticket.id}}" id="comments-view-{{ticket.id}}">
            {% endif %}
                Comments
                <span class="badge badge-light">
                    {{ticket.ticket_comments}}
                </span>
            </button>
            
            {% if ticket.file == "" %}
            <button class="btn btn-primary btn-block" disabled>
                Files
                <span class="badge badge-light">
                    NO
            {% else %}
            <button class="btn btn-primary btn-block" id="file-button-{{ticket.id}}" name="file-button-name" value="{{ticket.id}}">
                Files
                <span class="badge badge-light">
                    {{ticket.filename}}
            {% endif %}
                </span>
            </button>
            
            <p>Priority: {{ticket.get_priority_display}}</p>
            <p>Type: {{ticket.get_type_display}}</p>
            
            <p>Status: {{ticket.get_status_display}}</p>
            <div class="collapse mb-2" id="collapse-{{ticket.id}}">
                <div class="card card-body">
                    <table class="table">
                        <tbody>
                            {% for comment in comments %}
                                {% if comment.ticket.id == ticket.id %}
                                    <tr>
                                        <th>{{comment.number}}</th>
                                        <td>{{comment.text}}</th>
                                    </tr>
                                {% endif %}
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endfor %}

<nav aria-label="Page navigation">
    <ul class="pagination justify-content-center">
        {% if tickets.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page={{ tickets.previous_page_number }}">
                    <span aria-hidden="true">&laquo;</span>
                </a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ tickets.previous_page_number }}">{{tickets.previous_page_number}}</a>
            </li>
        {% else %}
            <li class="page-item disabled"><a class="page-link"><span>&laquo;</span></a></li>
        {% endif %}

        <li class="page-item">
            <a class="page-link" href="?page={{ tickets.number }}">{{tickets.number}}</a>
        </li>

        {% if tickets.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ tickets.next_page_number }}">{{tickets.next_page_number}}</a>
            </li>
            <li class="page-item">
                <a class="page-link" href="?page={{ tickets.next_page_number }}">
                    <span aria-hidden="true">&raquo;</span>
                </a>
            </li>
        {% else %}
            <li class="page-item disabled"><a class="page-link"><span>&raquo;</span></a></li>
        {% endif %}
    </ul>
</nav>

{% endblock %}